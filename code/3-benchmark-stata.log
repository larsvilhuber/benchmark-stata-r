
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: 2-user 32-core network, expiring 27 Apr 2025
Serial number: 501809316179
  Licensed to: Lars Vilhuber (Data Editor)
               American Economic Association

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do 3-benchmark-stata.do 

. /****************************************************************************
> ***********************
> To run the script, download the following packages:
> ssc install gtools
> ssc install fastreshape
> ssc install reghdfe
> ssc install autorename
> ssc install ftools
> *****************************************************************************
> **********************/
. 
. local scenario "A" 

. /* This works on all OS when running in batch mode, but may not work in inter
> active mode */
. local pwd : pwd                     // This always captures the current direc
> tory

. 
. if "`scenario'" == "A" {             // If in Scenario A, we need to change d
> irectory first
.     cd ..
/mnt/local/fast_home/vilhuber/tmp/benchmark-stata-r
. }

. if "`scenario'" == "C" {             // If in Scenario C, we need to go up tw
> ice
.     cd ../..
. }

. global rootdir : pwd                // Now capture the directory to use as ro
> otdir

. display in red "Rootdir has been set to: $rootdir"
Rootdir has been set to: /mnt/local/fast_home/vilhuber/tmp/benchmark-stata-r

. 
. 
. 
. /* timer helpers */
. cap program drop Tic

. program define Tic
  1.         syntax, n(integer)
  2.         timer on `n'
  3. end

. 
. cap program drop Toc

. program define Toc
  1.         syntax, n(integer) 
  2.         timer off `n'
  3. end

. 
. /*capture the number of processors */
. 
. di "Number of processors: " `=c(processors)'
Number of processors: 24

. di "Version of Stata:  `c(edition_real)'"
Version of Stata:  MP

. 
. /* read processors from R output CSV, and set local macro */
. import delimited using "${rootdir}/output/cores.csv", clear
(encoding automatically selected: ISO-8859-1)
(1 var, 1 obs)

. local cores = cores[1]

. di "Number of processors used: " `cores'
Number of processors used: 24

. clear

. 
. 
. import delimited using "${rootdir}/data/merge_string.csv", clear
(encoding automatically selected: ISO-8859-1)
(2 vars, 63,221,507 obs)

. autorename
(1 observation deleted)

. save "${rootdir}/data/merge_string.dta", replace
file
    /mnt/local/fast_home/vilhuber/tmp/benchmark-stata-r/data/merge_string.dta
    saved

. 
. import delimited using "${rootdir}/data/merge_int.csv", clear
(encoding automatically selected: ISO-8859-1)
(2 vars, 63,216,239 obs)

. save "${rootdir}/data/merge_int.dta", replace
file /mnt/local/fast_home/vilhuber/tmp/benchmark-stata-r/data/merge_int.dta
    saved

. 
. /****************************************************************************
> ***********************
> 
> *****************************************************************************
> **********************/
. 
. /* benchmark */
. set processors 2
    The maximum number of processors or cores being used is changed from 24
    to 2.  It can be set to any number between 1 and 24

. 
. timer clear

. local i = 0

. /* write and read */
. Tic, n(`++i')

. import delimited using "${rootdir}/data/1e8.csv", clear
(encoding automatically selected: ISO-8859-1)
(9 vars, 100,000,000 obs)

. Toc, n(`i')

. 
. Tic, n(`++i')

. save "${rootdir}/data/1e8.dta", replace
file /mnt/local/fast_home/vilhuber/tmp/benchmark-stata-r/data/1e8.dta saved

. Toc, n(`i')

. 
. drop _all 

. Tic, n(`++i')

. use "${rootdir}/data/1e8.dta", clear

. Toc, n(`i')

. 
. /* sort  */
. Tic, n(`++i')

. sort id3 

. Toc, n(`i')

. 
. Tic, n(`++i')

. sort id6

. Toc, n(`i')

. 
. Tic, n(`++i')

. sort v3

. Toc, n(`i')

. 
. Tic, n(`++i')

. gdistinct id3

       |        Observations
       |      total   distinct
-------+----------------------
   id3 |   1.00e+08    5000000

. Toc, n(`i')

. 
. Tic, n(`++i')

. gdistinct id6

       |        Observations
       |      total   distinct
-------+----------------------
   id6 |   1.00e+08    4999999

. Toc, n(`i')

. 
. /* merge */
. use "${rootdir}/data/1e8.dta", clear

. Tic, n(`++i')

. fmerge m:1 id1 id3 using "${rootdir}/data/merge_string.dta", keep(master matc
> hed) nogen
